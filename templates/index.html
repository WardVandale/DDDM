<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    
    <style>
        @font-face {
            font-family: 'Cinzel Decorative';
            src: url('/static/fonts/CinzelDecorative-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: white;
            text-align: center;
        }

        .center-content {
            width: 60%;
            max-width: 600px;
        }

        #textMessage {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 36px;
            line-height: 1.5;
            padding: 20px;
            color: #e0e0e0;
            text-shadow: 2px 2px 4px rgba(255, 0, 0, 0.7);
            animation: pulseGlow 2s infinite alternate;
        }

        #imageMessage img {
            height: auto;
        }

        .is_hidden {
            display: none;
        }

        @keyframes pulseGlow {
            0% {
                text-shadow: 2px 2px 8px rgba(255, 0, 0, 0.9);
            }
            100% {
                text-shadow: 4px 4px 12px rgba(255, 0, 0, 0.7);
            }
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="center-content">
        <div id="textMessage"></div>
        <div id="imageMessage">
            <!-- Image container without a default image -->
            <img id="currentImage" class="is_hidden" alt="Game Image">
        </div>
    </div>

    <script type="text/javascript">
        var currentImageUrl = null; // Start with no image URL

        function fetchImageSizes() {
            $.ajax({
                url: "/api/get_image_sizes",
                method: "GET",
                success: function(data) {
                    if (data.result) {
                        var sizes = data.sizes;

                        // Apply saved size if available for the current image
                        if (sizes[currentImageUrl]) {
                            var savedSize = sizes[currentImageUrl];
                            $('#currentImage').css('width', savedSize + '%');
                        }
                    }
                }
            });
        }

        fetchImageSizes();

        function fetchUpdates() {
            $.ajax({
                url: "/api/get_updates",
                method: "GET",
                success: function(data) {
                    var textDiv = $('#textMessage');
                    var imageDiv = $('#imageMessage');
                    var imageElement = $('#currentImage');

                    textDiv.html(''); // Clear text container

                    if (data.result && data.messages.length > 0) {
                        let hasTextMessage = false;

                        data.messages.forEach(function(message) {
                            if (message.type === 'text') {
                                textDiv.html('<p>' + message.content + '</p>');
                                hasTextMessage = true;
                            } else if (message.type === 'image') {
                                if (currentImageUrl !== message.content) {
                                    currentImageUrl = message.content;
                                    imageElement.attr('src', message.content).removeClass('is_hidden');
                                }

                                var imageSize = message.size || 100; // Default to 100% if size not specified
                                imageElement.css('width', imageSize + '%');
                            }
                        });

                        if (hasTextMessage) {
                            imageDiv.hide();
                            textDiv.show();
                        } else {
                            imageDiv.show();
                            textDiv.hide();
                        }
                    } else {
                        // Display a prompt when no messages are available
                        textDiv.html('<p>Please select a game on the admin console.</p>');
                        textDiv.show();
                        imageDiv.hide();
                    }
                }
            });
        }

        setInterval(fetchUpdates, 1000);
    </script>
</body>
</html>